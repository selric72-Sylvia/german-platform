<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<title>è¯æ±‡å­¦ä¹ ï¼ˆå¡ç‰‡æ¨¡å¼ï¼‰</title>
<link rel="stylesheet" href="../assets/style.css">
<style>
.card {
    border: 1px solid #ccc;
    padding: 20px;
    border-radius: 12px;
    margin-bottom: 20px;
    background: #fafafa;
}
.card h2 { margin-top: 0; }
.section-title { margin-bottom: 5px; font-weight: bold; }

.btn-row { display: flex; gap: 10px; margin-top: 15px; }
.btn-mini {
    padding: 10px;
    background: #4f8cff;
    color: white;
    border-radius: 6px;
    cursor: pointer;
    text-align: center;
    flex: 1;
}
.btn-mini:hover { background: #3d74d8; }

select, textarea {
    width: 100%; padding: 8px; margin: 10px 0;
}
</style>
</head>

<body>

<a href="../index.html" class="back">â† è¿”å›é¦–é¡µ</a>
<h2>ğŸ“˜ è¯æ±‡å­¦ä¹ ç³»ç»Ÿï¼ˆå¡ç‰‡æ¨¡å¼ï¼‰</h2>

<div>
    <label>å­¦ä¹ æ¨¡å¼ï¼š</label>
    <select id="modeSelect">
        <option value="new">æ–°å­¦å•è¯</option>
        <option value="review">å¤ä¹ å•è¯</option>
        <option value="all">å…¨éƒ¨å•è¯</option>
    </select>
</div>

<div class="card">
    <h2 id="word">åŠ è½½ä¸­...</h2>
    <p><strong>è¯æ€§ï¼š</strong> <span id="pos"></span></p>
    <p><strong>é‡Šä¹‰ï¼š</strong> <span id="meaning"></span></p>

    <p class="section-title">ä¾‹å¥ï¼š</p>
    <p id="example" style="color:#444"></p>

    <p class="section-title">è¯ç»„ï¼š</p>
    <p id="phrase" style="color:#444"></p>

    <div class="btn-row">
        <div class="btn-mini" onclick="markKnown()">æˆ‘è®°ä½äº†</div>
        <div class="btn-mini" onclick="nextWord()">ä¸‹ä¸€ä¸ª</div>
        <a class="btn-mini" href="vocab-test.html">è¿›å…¥æµ‹è¯•</a>
    </div>
</div>

<h3>ğŸ“¥ è‡ªåŠ¨å¯¼å…¥å•è¯</h3>
<textarea id="importBox" rows="6" placeholder="æ ¼å¼ï¼šword | pos | meaning | example | phrase"></textarea>
<div class="btn-mini" onclick="importWords()">å¯¼å…¥</div>

<script>
let vocab = [];
let currentList = [];
let index = 0;

async function loadData() {
    // â‘  ä»æœåŠ¡å™¨åŠ è½½åˆå§‹è¯åº“ï¼ˆvocab.jsonï¼‰
    const res = await fetch("../data/vocab.json");
    let baseVocab = await res.json();

    // â‘¡ ä» localStorage åŠ è½½ç”¨æˆ·å¯¼å…¥çš„è¯åº“
    let stored = JSON.parse(localStorage.getItem("vocab") || "[]");

    // â‘¢ åˆå¹¶ï¼Œä¸é‡å¤ï¼ˆæŒ‰å•è¯åï¼‰
    let combined = [...baseVocab];

    for (let w of stored) {
        if (!combined.some(x => x.word === w.word)) {
            combined.push(w);
        }
    }

    vocab = combined;

    // â‘£ ä¿å­˜åˆå¹¶åçš„è¯åº“åˆ° localStorageï¼ˆæŒä¹…åŒ–ï¼‰
    localStorage.setItem("vocab", JSON.stringify(vocab));

    // â‘¤ é‡å»ºå­¦ä¹ åˆ—è¡¨
    refreshList();
    showWord();
}

function refreshList() {
    const mode = document.getElementById("modeSelect").value;
    let known = JSON.parse(localStorage.getItem("knownWords") || "[]");

    if (mode === "new") {
        currentList = vocab.filter(w => !known.includes(w.word));
    } else if (mode === "review") {
        currentList = vocab.filter(w => known.includes(w.word));
    } else {
        currentList = vocab;
    }
    index = 0;
}

function showWord() {
    if (currentList.length === 0) {
        document.getElementById("word").innerText = "ï¼ˆè¯¥åˆ†ç±»æ— å•è¯ï¼‰";
        return;
    }
    const w = currentList[index];

    document.getElementById("word").innerText = w.word;
    document.getElementById("pos").innerText = w.pos;
    document.getElementById("meaning").innerText = w.meaning;
    document.getElementById("example").innerText = w.example || "ï¼ˆæ— ä¾‹å¥ï¼‰";
    document.getElementById("phrase").innerText = w.phrase || "ï¼ˆæ— è¯ç»„ï¼‰";
}

function nextWord() {
    index = (index + 1) % currentList.length;
    showWord();
}

function markKnown() {
    let known = JSON.parse(localStorage.getItem("knownWords") || "[]");
    const w = currentList[index];

    if (!known.includes(w.word)) known.push(w.word);
    localStorage.setItem("knownWords", JSON.stringify(known));

    refreshList();
    showWord();
}

function importWords() {
    const text = document.getElementById("importBox").value.trim();
    if (!text) return;

    const lines = text.split("\n");
    let newWords = [];

    for (let line of lines) {
        let p = line.split("|").map(s => s.trim());
        if (p.length < 5) continue;
        newWords.push({
            word: p[0],
            pos: p[1],
            meaning: p[2],
            example: p[3],
            phrase: p[4]
        });
    }

    vocab = vocab.concat(newWords);
    localStorage.setItem("vocab", JSON.stringify(vocab));
    alert("å¯¼å…¥æˆåŠŸï¼è¯·åˆ·æ–°é¡µé¢æˆ–åˆ‡æ¢å­¦ä¹ æ¨¡å¼ã€‚");
}

document.getElementById("modeSelect").addEventListener("change", () => {
    refreshList();
    showWord();
});

loadData();
</script>

</body>
</html>
